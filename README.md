# å¾®ä¿¡æœºå™¨äººé¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¾®ä¿¡æœºå™¨äººé¡¹ç›®ï¼Œæ‹¥æœ‰å‘é€ã€æ¥æ”¶æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œå…¶ä¸­æœºå™¨äººæ¶ˆæ¯çš„å‘é€æ˜¯åŸºäº `wechat-bot` å®ç°çš„ã€‚

## åŠŸèƒ½åˆ—è¡¨

| æ ‡é¢˜ | ç®€ä»‹ | ç”¨æ³• | é»˜è®¤çŠ¶æ€<br/>ğŸš«âœ… | æ–‡ä»¶ç›®å½• |
| ---  | ---- | --- | --- | ------- | 
| chat_glm_6b | æœ¬åœ°éƒ¨ç½² chat_glmï¼Œå¹¶é€šè¿‡http æ¥å£è°ƒç”¨ | ai ä¼ é€’ç»™ chatglm çš„å†…å®¹ | ğŸš« | `modules/chat_glm_6b` |
| chat_gpt_api | è°ƒç”¨ chat_gpt_apiï¼Œè¯¢é—® ai å†…å®¹ï¼ˆéœ€é…ç½®gptå¯†é’¥ï¼Œç§‘å­¦ä¸Šç½‘ï¼‰ | ai ä¼ é€’ç»™ chatgpt çš„å†…å®¹ | âœ… | `modules/chat_gpt_api` |
| dingdong | dingdong botï¼Œç»™æœºå™¨äººå‘ dingï¼Œæœºå™¨äººè¿”å› dong | ä»…ç®¡ç†å‘˜å¯ç”¨ã€‚ | âœ… | `modules/dingdong` |
| homeassistant | homeassistant æœåŠ¡ï¼Œè°ƒç”¨æœ¬åœ°çš„æŸäº›æœåŠ¡ | è¯·å‚è€ƒæ¨¡å—å†…å®¹è¿›è¡Œé‡å†™ | âœ… | `modules/homeassistant` |
| jenkins | jenkins è‡ªåŠ¨æ„å»ºæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡å‘é€èŠå¤©è§¦å‘æ„å»ºé¡¹ç›® | jenkinsæ„å»º é¡¹ç›®åç§° | ğŸš« | `modules/jenkins` |
| newspaper | é€šè¿‡è°ƒç”¨æœåŠ¡è·å–æ¯æ—¥æ–°é—» | æ–°é—» | ğŸš« | `modules/newspaper` |
| stable_diffusion | é€šè¿‡è°ƒç”¨æœ¬åœ°éƒ¨ç½²çš„ stable_diffusion è¿›è¡Œ ai ç»˜å›¾ï¼Œä¾èµ–å¦ä¸€ä¸ªå›¾ç‰‡è½¬å‘çš„é¡¹ç›® | AIç”»å›¾ æ­£å‘æ ‡ç­¾\\né€†å‘æ ‡ç­¾ | ğŸš« | `modules/stable_diffusion` |
| weather | é€šè¿‡è°ƒç”¨é­…æ—çš„å¤©æ°”æœåŠ¡è·å–å¤©æ°”ä¿¡æ¯ | å¤©æ°” | ğŸš« | `modules/weather` |

## Useage

### docker å¯åŠ¨

è¯·ä½¿ç”¨ `docker-compose.yaml` å¯åŠ¨ã€‚
```bash
docker compose up -d
```

## é¡¹ç›®æ ‘ç»“æ„

```bash
src
â”œâ”€ alapi
â”œâ”€ app.ts                  # å…¥å£ç±»
â”œâ”€ caffeine
â”œâ”€ entity                  # æ•°æ®åº“å®ä½“
â”œâ”€ mqtt                    # ç³»ç»Ÿ mqtt æ“ä½œ
â”œâ”€ system                  # ç³»ç»Ÿç›¸å…³æŒ‡ä»¤ï¼Œä»¥åŠæ•°æ®åº“æ“ä½œ
â”œâ”€ config.ts
â”œâ”€ modules                 # å„ç§æ¨¡å—
â”‚    â”œâ”€ chat_glm_6b        # glm æ¨¡å—
â”‚    â”œâ”€ chat_gpt_api       # gpt æ¨¡å—
â”‚    â”œâ”€ dingdong           # dingdong æœºå™¨äººï¼Œå‘ ding å› dong
â”‚    â”œâ”€ fishtouch          # æ‘¸é±¼æœºå™¨äººï¼Œå‘æ‘¸é±¼å›å¤æ‘¸é±¼
â”‚    â”œâ”€ homeassistant      # homeassistant æœºå™¨äººï¼Œè°ƒç”¨ ha æœºå™¨äºº
â”‚    â”œâ”€ jenkins            # jenkins æœºå™¨äººï¼Œå‘é€æ¶ˆæ¯è§¦å‘ jenkins æ„å»º
â”‚    â”œâ”€ load_modules.ts
â”‚    â”œâ”€ newspaper          # æ–°é—»æœºå™¨äººï¼Œæ’­æŠ¥æ¯æ—¥æ–°é—»
â”‚    â”œâ”€ stable_diffusion   # ai ç”»å›¾æœºå™¨äººï¼Œé€ä¼ æŒ‡ä»¤ç»™ stable_diffusion
â”‚    â”œâ”€ template           # æ¨¡å—æ¨¡æ¿ï¼Œè‹¥è¦æ·»åŠ æ¨¡å—è¯·å¤åˆ¶è¯¥ç›®å½•
â”‚    â”‚    â”œâ”€ config.ts     ## é…ç½®è®¾è®¡
â”‚    â”‚    â”œâ”€ disabled.ts   ## å¦‚æœç›®å½•ä¸‹æœ‰è¯¥æ–‡ä»¶ï¼Œä»£è¡¨è¯¥æ¨¡å—ä¸ä¼šè¢«åŠ è½½
â”‚    â”‚    â”œâ”€ request.ts    ## è°ƒç”¨APIè®¾è®¡
â”‚    â”‚    â””â”€ service.ts    ## æœåŠ¡æœ¬ä½“è®¾è®¡
â”‚    â””â”€ weather            # å¤©æ°”æ’­æŠ¥åŠŸèƒ½ï¼Œæ’­æŠ¥æ¯æ—¥å¤©æ°”
â”œâ”€ utils
â””â”€ wechat                  # å¾®ä¿¡åŸºç¡€å®ç°
```

## åŠŸèƒ½æ·»åŠ /å‰ªè£

å¯ä»¥é€šè¿‡æ‹·è´ src/modules/template å¹¶ä¿®æ”¹é€»è¾‘æ·»åŠ åŠŸèƒ½

å¯ä»¥åˆ é™¤ modules ä¸‹ä»»æ„æ¨¡å—åˆ é™¤ã€‚

# å¸¸è§é—®é¢˜
1. ä¸ºä»€ä¹ˆä¸€ä¸ªæ¶ˆæ¯ä¼šå›å¤4æ¬¡
   1. åŸå› æ˜¯å¯åŠ¨äº†å¤šä¸ªæ¨¡å—ï¼Œè¯·å°è¯•ä»…ä¿æŒä¸€ä¸ªè¿æ¥

## æµç¨‹

### å½“å‰æµç¨‹

![](./assets/01_mqtt.drawio.svg)

## MQTT topic

| åç§° | å¤‡æ³¨ | topic |
| --- | --- | --- |
| å‘é€å•èŠæ¶ˆæ¯ |  | wechat/{ç™»å½•çš„WXID}/send/user/{ç›®æ ‡ç”¨æˆ·WXID} |
| å‘é€ç¾¤èŠæ¶ˆæ¯ |  | wechat/{ç™»å½•çš„WXID}/send/group/{ç›®æ ‡ç¾¤çš„WXID} |
| æ¨¡å—åŠ è½½å¯åŠ¨æ¶ˆæ¯ |  | wechat/services/{æ¨¡å—çš„Code} |
| æ¥æ”¶å…¬ä¼—å·æ¶ˆæ¯ |  | wechat/{ç™»å½•çš„WXID}/receve/subscriptions/{å…¬ä¼—å·WXID} |
| æ¥æ”¶åˆ°ç¾¤èŠæ¶ˆæ¯ |  | wechat/{ç™»å½•çš„WXID}/receve/groups/{ç¾¤ç»„ID}/users/{å‘é€äººID}/{æ˜¯å¦ä¸º@æˆ‘} |
| æ¥æ”¶åˆ°å•èŠæ¶ˆæ¯ |  | wechat/{ç™»å½•çš„WXID}/receve/users/{å‘é€äººID} |
| å‘é€ç³»ç»Ÿè°ƒç”¨ |  | wechat/{ç™»å½•çš„WXID}/send/sys |
| æ¥æ”¶ç³»ç»Ÿè°ƒç”¨å›å¤ |  | wechat/{ç™»å½•çš„WXID}/receve/sys |

# TODOS
- [x] æ›´æ”¹æœåŠ¡å¯¼å…¥æ–¹å¼ï¼Œæ”¹ä¸ºå¯¼å…¥ service ç±»å¹¶é€šè¿‡ä»£ç åˆå§‹åŒ–
- [ ] ä¸ºå¿…è¦çš„db æ“ä½œåŠ å…¥ç¼“å­˜æ“ä½œã€‚
- [ ] 